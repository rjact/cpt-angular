<div class="container">
	<div class="patientInfo">
		<h2>Patient Information</h2>
		<dl>
			<dt><label for="patientFirstName">Patient First Name</label></dt>
			<dd><input type="text" [(ngModel)]="entry.Patient.PatientFirstName" class="form-control" (keyup)="searchPatient()" /></dd>
			<dt><label for="patientLastName">Patient Last Name</label></dt>
			<dd><input type="text" [(ngModel)]="entry.Patient.PatientLastName" class="form-control" (keyup)="searchPatient()" /></dd>
			<dt><label for="dob">Date of Birth</label></dt>
			<dd><input type="date" [(ngModel)]="entry.Patient.DOB"class="form-control" /></dd>
			<dt><label for="gender">Gender</label></dt>
			<dd>
				<select type="date" [(ngModel)]="entry.Patient.Gender" class="form-control">
					<option value="M">Male</option>
					<option value="F">Female</option>
				</select>
			</dd>
			<dt><label for="ehr">EHR #</label></dt>
			<dd><input type="text" [(ngModel)]="entry.Patient.EHRNumber" class="form-control" (keyup)="searchPatient()" /></dd>
		</dl>
		<div class="searchResults" *ngIf="patientSearchResults">
			<ul>
				<li *ngFor="let patient of patientSearchResults" (mousedown)="selectPatient(patient)">
					<div class="name">
						<span [innerHTML]="patient.PatientLastName.trim() | highlight: entry.Patient.PatientLastName | keepHtml"></span>,&nbsp;
						<span [innerHTML]="patient.PatientFirstName.trim() | highlight: entry.Patient.PatientFirstName | keepHtml"></span>
					</div>
					<div class="dob">{{patient.DOB | date}}</div>
					<div class="ehr" [innerHTML]="patient.EHRNumber | highlight: entry.Patient.EHRNumber | keepHtml"></div>
				</li>
			</ul>
		</div>
		<div class="procedures" *ngIf="patientProcedures">
			<ul>
				<li *ngFor="let procedure of patientProcedures" (mousedown)="selectProcedure(procedure)">
					<div class="name">{{procedure.ProcedureName}}</div>
					<div class="date">{{procedure.ProcedureDate | date}}</div>
					<div class="description">{{procedure.Description}}</div>
				</li>
				<li>
					<div class="btn" (click)="showNewProcedureForm()">
						Add new Procedure
					</div>
				</li>
			</ul>
		</div>
	</div>
	<div class="cptSection">
		<div class="procedureInfo" *ngIf="entry.Procedure">
			<div class="procedureName">{{entry.Procedure.ProcedureName}}</div>
			<div class="procedureDate">{{entry.Procedure.ProcedureDate | date}}</div>
		</div>
		<div class="actions">
			<div class="action byCode">
				<div class="actionBtn" (mousedown)="$event.target.classList.add('active')" (mouseup)="$event.target.classList.remove('active')" (click)="showForm($event)"><span>Enter Code</span></div>
				<div class="form">
					<input type="text" class="form-control" [(ngModel)]="newCode" (keyup)="searchCpts()">
					<div class="btn dark" (click)="addByCptCode()">Add New</div>
				</div>
				<div class="searchResults" *ngIf="cptSearchResults">
					<ul>
							<li class="noResults" *ngIf="cptSearchResults.length == 0">No CPT Codes Found</li>
						<li *ngFor="let res of cptSearchResults" (mousedown)="addCpt(res)">
							<div [innerHTML]="res.CPTCode | highlight: newCode | keepHtml"></div>
							<div>{{res.MediumDescriptor}}</div>
						</li>
					</ul>
				</div>
			</div>
			<div class="action bySearch">
				<div class="actionBtn" (mousedown)="$event.target.classList.add('active')" (mouseup)="$event.target.classList.remove('active')" (click)="showForm($event)"><span>Search</span></div>
				<div class="form">
					<input type="text" class="form-control" [(ngModel)]="searchTerm" (keyup)="search()"/>
					<div class="btn dark" (click)="search()">Search</div>
				</div>
				<div class="searchResults" *ngIf="searchResults">
					<ul>
						<li class="noResults" *ngIf="searchResults.length == 0">No CPT Codes Found</li>
						<li *ngFor="let res of searchResults" (click)="addCpt(res)">
							<div>{{res.CPTCode}}</div>
							<div [innerHTML]="res.MediumDescriptor | highlight: searchTerm | keepHtml"></div>
						</li>
					</ul>
				</div>
			</div>
			<div class="action bySequence">
				<div class="actionBtn" (click)="showForm($event);viewSequences()" (mousedown)="$event.target.classList.add('active')" (mouseup)="$event.target.classList.remove('active')"><span>View Sequences</span></div>
			</div>
		
		</div>
		<h2>CPT Codes</h2>
		<ul id="cptCodeList">
			<li *ngFor="let cpt of entry.Procedure.CptCodes" class="cptItem">
				<header>
					<div class="code">{{cpt.CPTCode}}</div>
					<div class="btn red" (click)="removeCpt(cpt.CPTCode)" *ngIf="entry.Procedure.Editable">Remove</div>
				</header>
				<div class="cptInfo">
					<div class="description">{{cpt.MediumDescriptor}}</div>
				</div>
				<div class="icd10Container" *ngIf="cpt.ICD10Codes.length > 0">
					<h3>ICD10 Codes</h3>
					<ul class="icd10s">
						<li *ngFor="let icd10 of cpt.ICD10Codes">
							<div class="icd10code">{{icd10.ICD_10CMCode}}</div>
							<div class="icd10desc">{{icd10.ICD_10CMFullDescription}}</div>
							<div class="btn red" (click)="removeIcd10(cpt, icd10.ICD_10CMCode)" *ngIf="entry.Procedure.Editable">Remove</div>
						</li>
					</ul>
				</div>
				<div class="cptActions">
					<div class="btn addIcd10" [ngClass]="{disabled: !cpt.AllIcd10Codes}" (click)="getIcd10s(cpt)" *ngIf="entry.Procedure.Editable">Add New ICD10</div>
				</div>
			</li>
		</ul>
		<div class="btn" (click)="save()" *ngIf="entry.Procedure.Editable && entry.Procedure.CptCodes.length > 0">Save</div>
	</div>

	<icd10codes [icd10codes]="activeCpt.AllIcd10Codes" *ngIf="showIcd10List" (onAddIcd10)="addIcd10($event)" (onClose)="closeModal($event)"></icd10codes>
	<sequences *ngIf="showSequences" (onAddCpt)="addCpt($event)" (onClose)="closeModal($event)"></sequences>
	<new-procedure *ngIf="showNewProcedure" (onClose)=closeModal($event) (onAddProcedure)="addProcedure($event)" [patientId]="entry.Patient.PatientID" [title]="'Add New Procedure'"></new-procedure>